#!/usr/bin/env node

var levelup = require('levelup');
var leveldown = require('leveldown');
var And = require('..');
var net = require('net');
var minimist = require('minimist');
var join = require('path').join;

var argv = minimist(process.argv.slice(2));
var port = argv.port || 8005;
var dbPath = argv.db
  ? join(process.cwd(), argv.db)
  : __dirname + '/../db';

var db = levelup(dbPath, { db: leveldown });
var and = And(db);

and.createServer().listen(port);

if (argv.listen) {
  net.createServer(function(con) {
    con.pipe(and.createStream()).pipe(con);
  }).listen(argv.listen);
}

if (argv.connect) {
  var con = net.connect(argv.connect);
  con.pipe(and.createStream()).pipe(con);
}

