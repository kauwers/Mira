var crdt = require('crdt');
var reconnect = require('reconnect-engine');
var render = require('../render');
var enter = require('enter-input');
var input = document.getElementById('input');

var doc = new crdt.Doc;
var messages = doc.createSeq('type', 'message');

reconnect(function(con) {
  con.pipe(doc.createStream()).pipe(con);
}).listen('/doc');

var list = render().sortTo(document.body, function(a, b) {
  var as = Number(a.querySelector('.message').dataset.get('sort'));
  var bs = Number(b.querySelector('.message').dataset.get('sort'));
  return bs - as;
});

messages.onEach(function(m) {
  list.write(m.state);
});

enter(input, function() {
  messages.push({ text: this.value });
  this.value = '';
});
input.focus();

